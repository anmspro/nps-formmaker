{"remainingRequest":"E:\\code\\vue-form-making\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\code\\vue-form-making\\src\\components\\Upload\\index.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"E:\\code\\vue-form-making\\src\\components\\Upload\\index.vue","mtime":1653889326450},{"path":"E:\\code\\vue-form-making\\node_modules\\css-loader\\index.js","mtime":1653903170036},{"path":"E:\\code\\vue-form-making\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1653903175370},{"path":"E:\\code\\vue-form-making\\node_modules\\postcss-loader\\src\\index.js","mtime":1653903175317},{"path":"E:\\code\\vue-form-making\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1653903247314},{"path":"E:\\code\\vue-form-making\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1653903169935},{"path":"E:\\code\\vue-form-making\\node_modules\\vue-loader\\lib\\index.js","mtime":1653903175370}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.fm-uplaod-container{\r\n  .is-disabled{\r\n    position: relative;\r\n\r\n    &::after{\r\n      position: absolute;\r\n      top: 0;\r\n      bottom: 0;\r\n      left: 0;\r\n      right: 0;\r\n      // background: rgba(0,0,0,.1);\r\n      content: '';\r\n      display: block;\r\n      cursor:not-allowed;\r\n    }\r\n  }\r\n\r\n  .upload-file{\r\n    margin: 0 10px 10px 0;\r\n    display: inline-flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    // background: #fff;\r\n    overflow: hidden;\r\n    background-color: #fff;\r\n    border: 1px solid #c0ccda;\r\n    border-radius: 6px;\r\n    box-sizing: border-box;\r\n    position: relative;\r\n    vertical-align: top;\r\n    &:hover{\r\n      .uplaod-action{\r\n        display: flex;\r\n      }\r\n    }\r\n    .uplaod-action{\r\n      position: absolute;\r\n      // top: 0;\r\n      // height: 30px;\r\n      bottom: 0;\r\n      left: 0;\r\n      right: 0;\r\n      background: rgba(0,0,0,0.6);\r\n      display: none;\r\n      justify-content: center;\r\n      align-items: center;\r\n      i{\r\n        color: #fff;\r\n        cursor: pointer;\r\n        margin: 0 5px;\r\n      }\r\n    }\r\n    &.is-success{\r\n      .item-status{\r\n        position: absolute;\r\n        right: -15px;\r\n        top: -6px;\r\n        width: 40px;\r\n        height: 24px;\r\n        background: #13ce66;\r\n        text-align: center;\r\n        transform: rotate(45deg);\r\n        box-shadow: 0 0 1pc 1px rgba(0,0,0,.2);\r\n        &>i{\r\n          font-size: 12px;\r\n          margin-top: 11px;\r\n          color: #fff;\r\n          transform: rotate(-45deg);\r\n        }\r\n      }\r\n    }\r\n    &.uploading{\r\n      &:before{\r\n        display: block;\r\n        content: '';\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: rgba(0,0,0,0.3);\r\n      }\r\n    }\r\n    .upload-progress{\r\n      position: absolute;\r\n      .el-progress__text{\r\n        color: #fff;\r\n        font-size: 16px !important;\r\n      }\r\n    }\r\n    img{\r\n      max-width: 100%;\r\n      max-height: 100%;\r\n      vertical-align: middle;\r\n    }\r\n  }\r\n  .el-upload--picture-card{\r\n    position: relative;\r\n    overflow: hidden;\r\n    .el-icon-plus{\r\n      position: absolute;\r\n      top: 50%;\r\n      left: 50%;\r\n    }\r\n  }\r\n  .upload-input{\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    display: block;\r\n    opacity: 0;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .drag-img-list{\r\n    display: inline;\r\n\r\n    .ghost{\r\n      position: relative;\r\n      &::after {\r\n        width: 100%;\r\n        height: 100%;\r\n        display: block;\r\n        content: '';\r\n        background: #fbfdff;\r\n        position: absolute;\r\n        top: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        border: 1px dashed #3bb3c2;\r\n      }\r\n    }\r\n\r\n    &>div{\r\n      cursor: move;\r\n    }\r\n  }\r\n}\r\n\r\n.viewer-container{\r\n  z-index: 9999 !important;\r\n}\r\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiTA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/Upload","sourcesContent":["<template>\r\n  <div class=\"fm-uplaod-container\"\r\n    :id=\"uploadId\"\r\n  >\r\n    <draggable class=\"drag-img-list\"\r\n      v-model=\"fileList\"\r\n      v-bind=\"{group: uploadId, ghostClass: 'ghost', animation: 200}\"\r\n      :no-transition-on-drag=\"true\"\r\n    >\r\n      <div \r\n        :id=\"item.key\"\r\n        :style=\"{width: width+'px', height: height+'px'}\"\r\n        :class=\"{uploading: item.status=='uploading', 'is-success': item.status=='success', 'is-diabled': disabled}\"\r\n        class=\"upload-file\" v-for=\"(item) in fileList\" :key=\"item.key\">\r\n        <img :src=\"item.url\" />\r\n\r\n        <el-progress v-if=\"item.status=='uploading'\" :width=\"miniWidth*0.9\" class=\"upload-progress\" type=\"circle\" :percentage=\"item.percent\"></el-progress>\r\n\r\n        <label class=\"item-status\" v-if=\"item.status=='success'\">\r\n          <i class=\"el-icon-upload-success el-icon-check\"></i>\r\n        </label>\r\n\r\n        <div class=\"uplaod-action\" :style=\"{height: miniWidth / 4 + 'px'}\" v-if=\"!disabled\">\r\n          <i class=\"iconfont icon-tupianyulan\" :title=\"$t('fm.upload.preview')\" @click=\"handlePreviewFile(item.key)\" :style=\"{'font-size': miniWidth/8+'px'}\"></i>\r\n          <i v-if=\"isEdit\" class=\"iconfont icon-sync1\" :title=\"$t('fm.upload.edit')\" @click=\"handleEdit(item.key)\" :style=\"{'font-size': miniWidth/8+'px'}\"></i>\r\n          <i v-if=\"isDelete && fileList.length > min\" class=\"iconfont icon-delete\" :title=\"$t('fm.upload.delete')\" @click=\"handleRemove(item.key)\" :style=\"{'font-size': miniWidth/8+'px'}\"></i>\r\n        </div>\r\n      </div>\r\n    </draggable>\r\n\r\n    <div class=\"el-upload el-upload--picture-card\"\r\n      :class=\"{'is-disabled': disabled}\"\r\n      v-show=\"(!isQiniu || (isQiniu && token)) && fileList.length < length\"\r\n      :style=\"{width: width+'px', height: height+'px'}\"\r\n      @click.self=\"handleAdd\"\r\n    >\r\n      <i class=\"el-icon-plus\" @click.self=\"handleAdd\" :style=\"{fontSize:miniWidth/4+'px',marginTop: (-miniWidth/8)+'px', marginLeft: (-miniWidth/8)+'px'}\"></i>\r\n      <input accept=\"image/*\" v-if=\"multiple\"  multiple ref=\"uploadInput\" @change=\"handleChange\" type=\"file\" :style=\"{width: 0, height: 0}\" name=\"file\" class=\"el-upload__input upload-input\">\r\n      <input accept=\"image/*\" v-else ref=\"uploadInput\" @change=\"handleChange\" type=\"file\" :style=\"{width:0, height: 0}\" name=\"file\" class=\"el-upload__input upload-input\">\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Viewer from 'viewerjs'\r\nimport Draggable from 'vuedraggable'\r\nimport * as qiniu from 'qiniu-js'\r\nrequire('viewerjs/dist/viewer.css')\r\nexport default {\r\n  components: {\r\n    Draggable\r\n  },\r\n  props: {\r\n    value: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    width: {\r\n      type: Number,\r\n      default: 100\r\n    },\r\n    height: {\r\n      type: Number,\r\n      default: 100\r\n    },\r\n    token: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    domain: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    multiple: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    length: {\r\n      type: Number,\r\n      default: 9\r\n    },\r\n    isQiniu: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    isDelete: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    min: {\r\n      type: Number,\r\n      default: 0\r\n    },\r\n    meitu: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    isEdit: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    action: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      fileList: this.value.map(item => {\r\n        return {\r\n          key: item.key ? item.key : (new Date().getTime()) + '_' + Math.ceil(Math.random() * 99999),\r\n          url: item.url,\r\n          percent: item.percent ? item.percent : 100,\r\n          status: item.status ? item.status : 'success'\r\n        }\r\n      }),\r\n      viewer: null,\r\n      uploadId: 'upload_' + new Date().getTime(),\r\n      editIndex: -1,\r\n      meituIndex: -1,\r\n    }\r\n  },\r\n  computed: {\r\n    miniWidth () {\r\n      if (this.width > this.height) {\r\n        return this.height\r\n      } else {\r\n        return this.width\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    this.$emit('input', this.fileList)\r\n  },\r\n  methods: {\r\n    handleChange () {\r\n      console.log(this.$refs.uploadInput.files)\r\n      const files = this.$refs.uploadInput.files\r\n      \r\n      for (let i = 0; i < files.length; i++) {\r\n        const file = files[i]\r\n        const reader = new FileReader()\r\n        const key = (new Date().getTime()) + '_' + Math.ceil(Math.random() * 99999)\r\n        reader.readAsDataURL(file)\r\n        reader.onload = () => {\r\n          if (this.editIndex >= 0) {\r\n\r\n            this.$set(this.fileList, this.editIndex, {\r\n              key,\r\n              url: reader.result,\r\n              percent: 0,\r\n              status: 'uploading'\r\n            })\r\n\r\n            this.editIndex = -1\r\n          } else {\r\n            this.fileList.push({\r\n              key,\r\n              url: reader.result,\r\n              percent: 0,\r\n              status: 'uploading'\r\n            })\r\n          }\r\n\r\n          this.$nextTick(() => {\r\n            if (this.isQiniu) {\r\n              this.uplaodAction2(reader.result, file, key)\r\n            } else {\r\n              this.uplaodAction(reader.result, file, key)\r\n            }\r\n          })\r\n        }\r\n      }\r\n      this.$refs.uploadInput.value = []\r\n    }, \r\n    uplaodAction (res, file, key) {\r\n      let changeIndex = this.fileList.findIndex(item => item.key === key)\r\n      console.log(this.fileList.findIndex(item => item.key === key))\r\n      const xhr = new XMLHttpRequest()\r\n      \r\n      const url = this.action\r\n      xhr.open('POST', url, true)\r\n      // xhr.setRequestHeader('Content-Type', 'multipart/form-data')\r\n\r\n      let formData = new FormData()\r\n      formData.append('file', file)\r\n\r\n      xhr.send(formData)\r\n      xhr.onreadystatechange = () => {\r\n        console.log(xhr)\r\n        if (xhr.readyState === 4) {\r\n          \r\n          let resData = JSON.parse(xhr.response)\r\n          if (resData && resData.url) {\r\n            this.$set(this.fileList, this.fileList.findIndex(item => item.key === key), {\r\n              ...this.fileList[this.fileList.findIndex(item => item.key === key)],\r\n              url: resData.url,\r\n              percent: 100\r\n            })\r\n            setTimeout(() => {\r\n              this.$set(this.fileList, this.fileList.findIndex(item => item.key === key), {\r\n                ...this.fileList[this.fileList.findIndex(item => item.key === key)],\r\n                status: 'success'\r\n              })\r\n              this.$emit('input', this.fileList)\r\n            }, 200)\r\n          } else {\r\n            this.$set(this.fileList, this.fileList.findIndex(item => item.key === key), {\r\n              ...this.fileList[this.fileList.findIndex(item => item.key === key)],\r\n              status: 'error'\r\n            })\r\n            this.fileList.splice(this.fileList.findIndex(item => item.key === key), 1)\r\n          }\r\n        }\r\n      }\r\n      xhr.onprogress = (res) => {\r\n        console.log('progress', res)\r\n        if (res.total && res.loaded) {\r\n          this.$set(this.fileList[this.fileList.findIndex(item => item.key === key)], 'percent', res.loaded/res.total*100)\r\n        }\r\n      }\r\n    },\r\n    uplaodAction2 (res, file, key) {\r\n      const _this = this\r\n      const observable = qiniu.upload(file, key, this.token, {\r\n        fname: key,\r\n        mimeType: []\r\n      }, {\r\n        useCdnDomain: true,\r\n        region: qiniu.region.z2\r\n      })\r\n      observable.subscribe({\r\n        next (res) {\r\n          _this.$set(_this.fileList[_this.fileList.findIndex(item => item.key === key)], 'percent', parseInt(res.total.percent))\r\n          \r\n        },\r\n        error (err) {\r\n          _this.$set(_this.fileList, _this.fileList.findIndex(item => item.key === key), {\r\n            ..._this.fileList[_this.fileList.findIndex(item => item.key === key)],\r\n            status: 'error'\r\n          })\r\n          _this.fileList.splice(_this.fileList.findIndex(item => item.key === key), 1)\r\n        },\r\n        complete (res) {\r\n          _this.$set(_this.fileList, _this.fileList.findIndex(item => item.key === key), {\r\n            ..._this.fileList[_this.fileList.findIndex(item => item.key === key)],\r\n            url: _this.domain + res.key,\r\n            percent: 100\r\n          })\r\n          setTimeout(() => {\r\n            _this.$set(_this.fileList, _this.fileList.findIndex(item => item.key === key), {\r\n              ..._this.fileList[_this.fileList.findIndex(item => item.key === key)],\r\n              status: 'success'\r\n            })\r\n            _this.$emit('input', _this.fileList)\r\n          }, 200)\r\n        }\r\n      })\r\n    },\r\n    handleRemove (key) {\r\n      this.fileList.splice(this.fileList.findIndex(item => item.key === key), 1)\r\n    },\r\n    handleEdit (key) {\r\n      \r\n      this.editIndex = this.fileList.findIndex(item => item.key === key)\r\n      \r\n      this.$refs.uploadInput.click()\r\n    },\r\n    handleMeitu (key) {\r\n\r\n      this.$emit('on-meitu', this.fileList.findIndex(item => item.key === key))\r\n    },\r\n    handleAdd () {\r\n      if (!this.disabled) {\r\n        this.editIndex = -1\r\n        this.$refs.uploadInput.click()\r\n      }\r\n    },\r\n    handlePreviewFile (key) {\r\n      this.viewer && this.viewer.destroy()\r\n      this.uploadId = 'upload_' + new Date().getTime()\r\n      \r\n      console.log(this.viewer)\r\n      this.$nextTick(() => {\r\n        this.viewer = new Viewer(document.getElementById(this.uploadId))\r\n        this.viewer.view(this.fileList.findIndex(item => item.key === key))\r\n      })\r\n    }\r\n  },\r\n  watch: {\r\n    'fileList': {\r\n      deep: true,\r\n      handler (val) {\r\n        // this.$emit('input', this.fileList)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.fm-uplaod-container{\r\n  .is-disabled{\r\n    position: relative;\r\n\r\n    &::after{\r\n      position: absolute;\r\n      top: 0;\r\n      bottom: 0;\r\n      left: 0;\r\n      right: 0;\r\n      // background: rgba(0,0,0,.1);\r\n      content: '';\r\n      display: block;\r\n      cursor:not-allowed;\r\n    }\r\n  }\r\n\r\n  .upload-file{\r\n    margin: 0 10px 10px 0;\r\n    display: inline-flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    // background: #fff;\r\n    overflow: hidden;\r\n    background-color: #fff;\r\n    border: 1px solid #c0ccda;\r\n    border-radius: 6px;\r\n    box-sizing: border-box;\r\n    position: relative;\r\n    vertical-align: top;\r\n    &:hover{\r\n      .uplaod-action{\r\n        display: flex;\r\n      }\r\n    }\r\n    .uplaod-action{\r\n      position: absolute;\r\n      // top: 0;\r\n      // height: 30px;\r\n      bottom: 0;\r\n      left: 0;\r\n      right: 0;\r\n      background: rgba(0,0,0,0.6);\r\n      display: none;\r\n      justify-content: center;\r\n      align-items: center;\r\n      i{\r\n        color: #fff;\r\n        cursor: pointer;\r\n        margin: 0 5px;\r\n      }\r\n    }\r\n    &.is-success{\r\n      .item-status{\r\n        position: absolute;\r\n        right: -15px;\r\n        top: -6px;\r\n        width: 40px;\r\n        height: 24px;\r\n        background: #13ce66;\r\n        text-align: center;\r\n        transform: rotate(45deg);\r\n        box-shadow: 0 0 1pc 1px rgba(0,0,0,.2);\r\n        &>i{\r\n          font-size: 12px;\r\n          margin-top: 11px;\r\n          color: #fff;\r\n          transform: rotate(-45deg);\r\n        }\r\n      }\r\n    }\r\n    &.uploading{\r\n      &:before{\r\n        display: block;\r\n        content: '';\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: rgba(0,0,0,0.3);\r\n      }\r\n    }\r\n    .upload-progress{\r\n      position: absolute;\r\n      .el-progress__text{\r\n        color: #fff;\r\n        font-size: 16px !important;\r\n      }\r\n    }\r\n    img{\r\n      max-width: 100%;\r\n      max-height: 100%;\r\n      vertical-align: middle;\r\n    }\r\n  }\r\n  .el-upload--picture-card{\r\n    position: relative;\r\n    overflow: hidden;\r\n    .el-icon-plus{\r\n      position: absolute;\r\n      top: 50%;\r\n      left: 50%;\r\n    }\r\n  }\r\n  .upload-input{\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    display: block;\r\n    opacity: 0;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .drag-img-list{\r\n    display: inline;\r\n\r\n    .ghost{\r\n      position: relative;\r\n      &::after {\r\n        width: 100%;\r\n        height: 100%;\r\n        display: block;\r\n        content: '';\r\n        background: #fbfdff;\r\n        position: absolute;\r\n        top: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        border: 1px dashed #3bb3c2;\r\n      }\r\n    }\r\n\r\n    &>div{\r\n      cursor: move;\r\n    }\r\n  }\r\n}\r\n\r\n.viewer-container{\r\n  z-index: 9999 !important;\r\n}\r\n</style>\r\n"]}]}