{"remainingRequest":"E:\\code\\vue-form-making\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\code\\vue-form-making\\src\\components\\WidgetForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\code\\vue-form-making\\src\\components\\WidgetForm.vue","mtime":1654408360751},{"path":"E:\\code\\vue-form-making\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1653903169935},{"path":"E:\\code\\vue-form-making\\node_modules\\babel-loader\\lib\\index.js","mtime":1653803163997},{"path":"E:\\code\\vue-form-making\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1653903169935},{"path":"E:\\code\\vue-form-making\\node_modules\\vue-loader\\lib\\index.js","mtime":1653903175370}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Draggable from 'vuedraggable'\r\nimport WidgetFormItem from './WidgetFormItem'\r\n\r\nexport default {\r\n  components: {\r\n    Draggable,\r\n    WidgetFormItem\r\n  },\r\n  props: ['data', 'select'],\r\n  data () {\r\n    return {\r\n      selectWidget: this.select\r\n    }\r\n  },\r\n  mounted () {\r\n    document.body.ondrop = function (event) {\r\n      let isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1\r\n      if (isFirefox) {\r\n        event.preventDefault()\r\n        event.stopPropagation()\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    handleMoveEnd ({newIndex, oldIndex}) {\r\n      console.log('index', newIndex, oldIndex)\r\n    },\r\n    handleSelectWidget (index) {\r\n      console.log(index, '#####')\r\n      this.selectWidget = this.data.list[index]\r\n    },\r\n    handleWidgetAdd (evt) {\r\n      console.log('add', evt)\r\n      console.log('end', evt)\r\n      const newIndex = evt.newIndex\r\n      const to = evt.to\r\n      console.log(to)\r\n      \r\n      //为拖拽到容器的元素添加唯一 key\r\n      const key = Date.parse(new Date()) + '_' + Math.ceil(Math.random() * 99999)\r\n      this.$set(this.data.list, newIndex, {\r\n        ...this.data.list[newIndex],\r\n        options: {\r\n          ...this.data.list[newIndex].options,\r\n          remoteFunc: 'func_' + key\r\n        },\r\n        key,\r\n        // 绑定键值\r\n        model: this.data.list[newIndex].type + '_' + key,\r\n        rules: []\r\n      })\r\n\r\n      if (this.data.list[newIndex].type === 'nps' || this.data.list[newIndex].type === 'radio' || this.data.list[newIndex].type === 'checkbox' || this.data.list[newIndex].type === 'select') {\r\n        this.$set(this.data.list, newIndex, {\r\n          ...this.data.list[newIndex],\r\n          options: {\r\n            ...this.data.list[newIndex].options,\r\n            options: this.data.list[newIndex].options.options.map(item => ({\r\n              ...item\r\n            }))\r\n          }\r\n        })\r\n      }\r\n\r\n      if (this.data.list[newIndex].type === 'grid') {\r\n        this.$set(this.data.list, newIndex, {\r\n          ...this.data.list[newIndex],\r\n          columns: this.data.list[newIndex].columns.map(item => ({...item}))\r\n        })\r\n      }\r\n\r\n      this.selectWidget = this.data.list[newIndex]\r\n    },\r\n    handleWidgetColAdd ($event, row, colIndex) {\r\n      console.log('coladd', $event, row, colIndex)\r\n      const newIndex = $event.newIndex\r\n      const oldIndex = $event.oldIndex\r\n      const item = $event.item\r\n\r\n      // 防止布局元素的嵌套拖拽\r\n      if (item.className.indexOf('data-grid') >= 0) {\r\n\r\n        // 如果是列表中拖拽的元素需要还原到原来位置\r\n        item.tagName === 'DIV' && this.data.list.splice(oldIndex, 0, row.columns[colIndex].list[newIndex])\r\n\r\n        row.columns[colIndex].list.splice(newIndex, 1)\r\n\r\n        return false\r\n      }\r\n\r\n      console.log('from', item)\r\n\r\n      const key = Date.parse(new Date()) + '_' + Math.ceil(Math.random() * 99999)\r\n\r\n      this.$set(row.columns[colIndex].list, newIndex, {\r\n        ...row.columns[colIndex].list[newIndex],\r\n        options: {\r\n          ...row.columns[colIndex].list[newIndex].options,\r\n          remoteFunc: 'func_' + key\r\n        },\r\n        key,\r\n        // 绑定键值\r\n        model: row.columns[colIndex].list[newIndex].type + '_' + key,\r\n        rules: []\r\n      })\r\n\r\n      if (row.columns[colIndex].list[newIndex].type === 'nps' || row.columns[colIndex].list[newIndex].type === 'radio' || row.columns[colIndex].list[newIndex].type === 'checkbox' || row.columns[colIndex].list[newIndex].type === 'select') {\r\n        this.$set(row.columns[colIndex].list, newIndex, {\r\n          ...row.columns[colIndex].list[newIndex],\r\n          options: {\r\n            ...row.columns[colIndex].list[newIndex].options,\r\n            options: row.columns[colIndex].list[newIndex].options.options.map(item => ({\r\n              ...item\r\n            }))\r\n          }\r\n        })\r\n      }\r\n\r\n      this.selectWidget = row.columns[colIndex].list[newIndex]\r\n    },\r\n    handleWidgetDelete (index) {\r\n      if (this.data.list.length - 1 === index) {\r\n        if (index === 0) {\r\n          this.selectWidget = {}\r\n        } else {\r\n          this.selectWidget = this.data.list[index - 1]\r\n        }\r\n      } else {\r\n        this.selectWidget = this.data.list[index + 1]\r\n      }\r\n\r\n      this.$nextTick(() => {\r\n        this.data.list.splice(index, 1)\r\n      })\r\n    },\r\n  },\r\n  watch: {\r\n    select (val) {\r\n      this.selectWidget = val\r\n    },\r\n    selectWidget: {\r\n      handler (val) {\r\n        this.$emit('update:select', val)\r\n      },\r\n      deep: true\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["WidgetForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"WidgetForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"widget-form-container\">\r\n    <div v-if=\"data.list.length == 0\" class=\"form-empty\">{{$t('fm.description.containerEmpty')}}</div>\r\n    <el-form :size=\"data.config.size\" label-suffix=\":\" :label-position=\"data.config.labelPosition\" :label-width=\"data.config.labelWidth + 'px'\">\r\n      \r\n      <draggable class=\"\" \r\n        v-model=\"data.list\" \r\n        v-bind=\"{group:'people', ghostClass: 'ghost',animation: 200, handle: '.drag-widget'}\"\r\n        @end=\"handleMoveEnd\"\r\n        @add=\"handleWidgetAdd\"\r\n      >\r\n\r\n        <transition-group name=\"fade\" tag=\"div\" class=\"widget-form-list\">\r\n          <template v-for=\"(element, index) in data.list\">\r\n            <template v-if=\"element.type == 'grid'\">\r\n                <el-row class=\"widget-col widget-view\" v-if=\"element && element.key\" :key=\"element.key\" \r\n                  type=\"flex\"\r\n                  :class=\"{active: selectWidget.key == element.key}\"\r\n                  :gutter=\"element.options.gutter ? element.options.gutter : 0\"\r\n                  :justify=\"element.options.justify\"\r\n                  :align=\"element.options.align\"\r\n                  @click.native=\"handleSelectWidget(index)\">\r\n                  <el-col  v-for=\"(col, colIndex) in element.columns\" :key=\"colIndex\" :span=\"col.span ? col.span : 0\">\r\n                      <draggable\r\n                        v-model=\"col.list\"\r\n                        :no-transition-on-drag=\"true\"\r\n                        v-bind=\"{group:'people', ghostClass: 'ghost',animation: 200, handle: '.drag-widget'}\"\r\n                        @end=\"handleMoveEnd\"\r\n                        @add=\"handleWidgetColAdd($event, element, colIndex)\"\r\n                      >\r\n                        <transition-group name=\"fade\" tag=\"div\" class=\"widget-col-list\">\r\n                          <template v-for=\"(el, i) in col.list\">\r\n                            <widget-form-item                             \r\n                              :key=\"el.key\"\r\n                              v-if=\"el.key\"\r\n                              :element=\"el\" \r\n                              :select.sync=\"selectWidget\" \r\n                              :index=\"i\" \r\n                              :data=\"col\">\r\n                            </widget-form-item>\r\n                          </template>\r\n                          \r\n                        </transition-group>\r\n                        \r\n                      </draggable>\r\n                  </el-col>\r\n                  <div class=\"widget-view-action widget-col-action\" v-if=\"selectWidget.key == element.key\">\r\n        \r\n                    <i class=\"iconfont icon-trash\" @click.stop=\"handleWidgetDelete(index)\"></i>\r\n                  </div>\r\n\r\n                  <div class=\"widget-view-drag widget-col-drag\" v-if=\"selectWidget.key == element.key\">\r\n                    <i class=\"iconfont icon-drag drag-widget\"></i>\r\n                  </div>\r\n                </el-row>\r\n            </template>\r\n            <template v-else>\r\n              <widget-form-item v-if=\"element && element.key\"  :key=\"element.key\" :element=\"element\" :select.sync=\"selectWidget\" :index=\"index\" :data=\"data\"></widget-form-item>\r\n            </template>\r\n          </template>\r\n        </transition-group>\r\n      </draggable>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Draggable from 'vuedraggable'\r\nimport WidgetFormItem from './WidgetFormItem'\r\n\r\nexport default {\r\n  components: {\r\n    Draggable,\r\n    WidgetFormItem\r\n  },\r\n  props: ['data', 'select'],\r\n  data () {\r\n    return {\r\n      selectWidget: this.select\r\n    }\r\n  },\r\n  mounted () {\r\n    document.body.ondrop = function (event) {\r\n      let isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1\r\n      if (isFirefox) {\r\n        event.preventDefault()\r\n        event.stopPropagation()\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    handleMoveEnd ({newIndex, oldIndex}) {\r\n      console.log('index', newIndex, oldIndex)\r\n    },\r\n    handleSelectWidget (index) {\r\n      console.log(index, '#####')\r\n      this.selectWidget = this.data.list[index]\r\n    },\r\n    handleWidgetAdd (evt) {\r\n      console.log('add', evt)\r\n      console.log('end', evt)\r\n      const newIndex = evt.newIndex\r\n      const to = evt.to\r\n      console.log(to)\r\n      \r\n      //为拖拽到容器的元素添加唯一 key\r\n      const key = Date.parse(new Date()) + '_' + Math.ceil(Math.random() * 99999)\r\n      this.$set(this.data.list, newIndex, {\r\n        ...this.data.list[newIndex],\r\n        options: {\r\n          ...this.data.list[newIndex].options,\r\n          remoteFunc: 'func_' + key\r\n        },\r\n        key,\r\n        // 绑定键值\r\n        model: this.data.list[newIndex].type + '_' + key,\r\n        rules: []\r\n      })\r\n\r\n      if (this.data.list[newIndex].type === 'nps' || this.data.list[newIndex].type === 'radio' || this.data.list[newIndex].type === 'checkbox' || this.data.list[newIndex].type === 'select') {\r\n        this.$set(this.data.list, newIndex, {\r\n          ...this.data.list[newIndex],\r\n          options: {\r\n            ...this.data.list[newIndex].options,\r\n            options: this.data.list[newIndex].options.options.map(item => ({\r\n              ...item\r\n            }))\r\n          }\r\n        })\r\n      }\r\n\r\n      if (this.data.list[newIndex].type === 'grid') {\r\n        this.$set(this.data.list, newIndex, {\r\n          ...this.data.list[newIndex],\r\n          columns: this.data.list[newIndex].columns.map(item => ({...item}))\r\n        })\r\n      }\r\n\r\n      this.selectWidget = this.data.list[newIndex]\r\n    },\r\n    handleWidgetColAdd ($event, row, colIndex) {\r\n      console.log('coladd', $event, row, colIndex)\r\n      const newIndex = $event.newIndex\r\n      const oldIndex = $event.oldIndex\r\n      const item = $event.item\r\n\r\n      // 防止布局元素的嵌套拖拽\r\n      if (item.className.indexOf('data-grid') >= 0) {\r\n\r\n        // 如果是列表中拖拽的元素需要还原到原来位置\r\n        item.tagName === 'DIV' && this.data.list.splice(oldIndex, 0, row.columns[colIndex].list[newIndex])\r\n\r\n        row.columns[colIndex].list.splice(newIndex, 1)\r\n\r\n        return false\r\n      }\r\n\r\n      console.log('from', item)\r\n\r\n      const key = Date.parse(new Date()) + '_' + Math.ceil(Math.random() * 99999)\r\n\r\n      this.$set(row.columns[colIndex].list, newIndex, {\r\n        ...row.columns[colIndex].list[newIndex],\r\n        options: {\r\n          ...row.columns[colIndex].list[newIndex].options,\r\n          remoteFunc: 'func_' + key\r\n        },\r\n        key,\r\n        // 绑定键值\r\n        model: row.columns[colIndex].list[newIndex].type + '_' + key,\r\n        rules: []\r\n      })\r\n\r\n      if (row.columns[colIndex].list[newIndex].type === 'nps' || row.columns[colIndex].list[newIndex].type === 'radio' || row.columns[colIndex].list[newIndex].type === 'checkbox' || row.columns[colIndex].list[newIndex].type === 'select') {\r\n        this.$set(row.columns[colIndex].list, newIndex, {\r\n          ...row.columns[colIndex].list[newIndex],\r\n          options: {\r\n            ...row.columns[colIndex].list[newIndex].options,\r\n            options: row.columns[colIndex].list[newIndex].options.options.map(item => ({\r\n              ...item\r\n            }))\r\n          }\r\n        })\r\n      }\r\n\r\n      this.selectWidget = row.columns[colIndex].list[newIndex]\r\n    },\r\n    handleWidgetDelete (index) {\r\n      if (this.data.list.length - 1 === index) {\r\n        if (index === 0) {\r\n          this.selectWidget = {}\r\n        } else {\r\n          this.selectWidget = this.data.list[index - 1]\r\n        }\r\n      } else {\r\n        this.selectWidget = this.data.list[index + 1]\r\n      }\r\n\r\n      this.$nextTick(() => {\r\n        this.data.list.splice(index, 1)\r\n      })\r\n    },\r\n  },\r\n  watch: {\r\n    select (val) {\r\n      this.selectWidget = val\r\n    },\r\n    selectWidget: {\r\n      handler (val) {\r\n        this.$emit('update:select', val)\r\n      },\r\n      deep: true\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}